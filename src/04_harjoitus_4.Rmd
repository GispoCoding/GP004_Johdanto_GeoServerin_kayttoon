# HARJOITUS I.4: KUVAUSTEKNIIKAN PERUSTEET (SLD)

**Harjoituksen sisältö**

Harjoituksessa käsitellään eri aineistoille sovellettavia kuvaustekniikoita ja hyödynnetään SLD-tyylejä karttojen visualisointiin.

**Harjoituksen tavoite**

Harjoituksen jälkeen opiskelija osaa hyödyntää peruskuvaustekniikoita GeoServerillä eri aineistojen visualisointiin, käyttäen SLD-kieltä.

**Arvioitu kesto**

40 minuuttia.

## **Valmistautuminen**

Käynnistä koneessa web-selain ja kirjaudu osoitteeseen:

Aiemmissa harjoituksissa on luotu GeoServerin palvelimelle taso **rakennukset**, johon luodaan nyt kuvaustekniikka.

## **GeoServerin kuvaustekniikka**

WMS-palvelut visualisoivat karttakuvia GeoServerissä ennalta määritetyillä kuvaustekniikoilla. Tähän asti olemme käyttäneet oletuskuvaustekniikoita aina lisättyämme uusia aineistoja, esimerkiksi kun olemme esikatselleet jotain tasoa.

Avaa päävalikosta **Layers**-näkymä ja **rakennukset**-taso. Avaa sitten **Publishing**-välilehti.![](https://lh5.googleusercontent.com/Q2gO9tkzFyhGNzkMskQMP4Y5CtOEnYtTXbVk_DuqPcMtNYGGRYqVJ5AoAsYbLh4F6rZ2oG_679DWscGCvwo45QW8i_5jfgYYji80Do4sl7_e4M_boUBP_MMoytFAuG8LgueYiMClbQSQnvWrzNshd7xpD-6DmbdzTEwVIhcp5mZMVAKdZdmWvAgHDVZ6)Huomaa, että **WMS Settings** -kohdasta löytyy **Default Style** -valikko, johon on valittu **polygon**-kuvaustekniikka.

\
![](https://lh4.googleusercontent.com/uMbyiuQjPvbfMkzw1d59jk-eqR-jjHQ1NN6V0zdGMajg80_yNvfpJEi-Gop2MGkRHS10EfgqROuT-4TqsORuXgQrpgpe_US3cc_qdu8DC5JG6R3piPTI86hGzPU86KsAJCFPH1GyOIl_7IymdVNiJuxOdfDYEzTyfUOPD-CU9IdkxvHUHKH9wxp_cHnF)

## **SLD-kuvaustekniikka**

Geoserverin tyylit on määritelty **Styled Layer Descriptorilla** (SLD), joka on XML-kieli.

Poistu tason näkymästä ja avaa **Data → Styles** näkymä päävalikon alta. Tässä näkymässä määritellään tyylit (kuvaustekniikat), joita WMS-karttatasoissa käytetään.

Listalla on parikymmentä tyyliä valmiina, jotka tulevat GeoServerin asennuksen mukana. Katsotaan aluksi, miltä **rakennukset**-tason käyttämä polygon-tyyli näyttää. Avaa se painamalla **polygon**-kohtaa. ![](https://lh4.googleusercontent.com/7wmSU1hD0Z7JlVaxlQJ4HefWYL2H724vJQ3pWYQUFIyBdrXS7N98tT9ea1riMoyiUjAvXyw5X3UWRtWyADhntwdsPVhFSqPDxN7Dx5rp8y7h--QV8z863XLjG4JXXn4zBkyrg1ejP3rxC3Xs3lFARZ-Lb3gCjqgFfQs4jxqP_BeWf-QPErOz-UXjB1AC)

Huomaa, että **Format** on **SLD**. Tutustu nyt tyylin koodiin: se muistuttaa verkkosivujen HTML-koodia. Siinä voit tunnistaa muun muassa **\<Fill\>**-ja **\<Stroke\>**-tagit, jotka määrittelevät monikulmion täyte- ja rajaviivan värejä.

Koodin toimivuutta voi kokeilla **Validate**- ja selitteen esikatselua **Preview legend** -toiminnolla.

Palaa **Styles**-näkymään painamalla **Cancel**.

## **Uuden tyylin luominen**

Laaditaan nyt oma kuvaustekniikka Helsingin rakennukset -aineistolle.

**Data → Styles** näkymässä, lisää uusi SLD-tyyli painamalla **Add a new style**.

Anna uudelle tyylille nimeksi **oletus_polygoni**. Valitse workspace:ksi **helsinki**.

![](https://lh4.googleusercontent.com/XxjyA0U7pn2_WEh1v6UPLBM1mCIlEES0WI1InkbQWn0yT60DyoA4HpU0Zmb59RpuBx8kB7rrmC1qbeg6qQ_LcsAHmgMRyntLC6Sx4yvti7AvlQntmky0nRfmM1P-34DYavZ1dHoN1hX3Be7w2OxI-p0BtZ7LAY3OHizXaRkIncGywFwkiqAcrklS112j)

Helpottaakseen omien tyylien kirjoittamisen aloittamista, SLD-koodikentän täyttämiseen voidaan valita malliksi GeoServerin oletustyylit tai kopioida olemassa oleva tyyli.

Valitse **Generate a default style** -alasvetovalikosta **Polygon** ja paina sen jälkeen **Generate...**![](https://lh6.googleusercontent.com/rYMJ-o4f3bHqKVOOauv6-Rw7M_zK55QqRoDax0DAzlKk_G4oeD0R0PehdQ1yEtVhuHRJ1BC_WHde4uuNisZYEHkqdChtslc_cjJhgQNYZC5YDpAj5HG1rXiu6cRF0aatwZ_4qj1N3fpP7l5z1HvbXGO5MKPVbgmeRSLOK3lICyyHZbWz__dJx-xB3N9w)

Voit nyt testata SLD-koodia **Validate-**toiminnolla. Testauksen onnistuminen näkyy ilmoituksena sivun yläpuolella.

![](https://lh4.googleusercontent.com/dRtlhVHLDvQ5KbAQOuT5RbgFhyMlToHReQhUSVO_lmEVjUbDDKd6D0VL4tMTshvjAILOc9Q2yEp2IN_rkVT4gjcLF5QwLNmekfJg4rO7Uw_8tWt66bWRuODjl4WulLYkLX9M_zcVfSbSgAmW9sHU77lsflE6IbRysO8XfTl1sFOjatL0aNDM6-XB6UjC)

Tallenna muutokset painamalla ensin **Submit**.

## **SLD-kuvaustekniikan käyttöönotto**

Kun uusi tyyli on luotu, voimme käyttää sitä aineistojen visualisoinnissa, esimerkiksi Helsingin rakennuksien esittämiseen kartalla. Sitä varten ilmoitamme GeoServerille, millä tyylillä **rakennukset**-taso on piirrettävä.

Avaa **rakennukset**-tason editointinäkymä päävalikosta **Data → Layers**. 

**Publishing** välilehdellä valitse **Default Style** -valikosta uusi **oletus_polygoni**-tyyli.

Paina sitten **Save**.

**Data → Layer Preview** näkymästä voit nyt esikatsella **rakennukset**-tasoa, uusi tyyli on nyt käytössä.![](https://lh6.googleusercontent.com/68kaqvJIupXeyrknLs9el2tADO2DWw1_bDgSnXTh1XghsFBqF3tsKvfc2yi-citjq2P1VApIDIBmuDA1I_cfXXhf1Cr7ufX5FWn6qnFmAEt6UnjxrvYDzKP0H1BIk9hqrbSzXT-gmRZYFDMHdoCVn42Mws8JW2AAH9dpzlLHPU3tss09ycBjuFLoluaT)

## **SLD Cookbook**

Kannattaa tutustua SLD-tyylien kirjoittamiseen SLD Cookbook -sivuilta. SLD Cookbook on osa GeoServerin verkkodokumentaatiota ja sisältää erilaisia kuvaustekniikkaesimerkkejä.

Käytetään seuraavaksi pohjana uuteen tyyliimme esimerkkiä **SLD Cookbookista**. 

Avaa uudessa selainikkunassa GeoServerin SLD Cookbook alla olevasta linkistä (tai voit etsiä selaimella Googlesta "geoserver sld cookbook"). Etsi **Polygon with styled label** -kohta ja paina sitä:

::: note-box
<http://docs.geoserver.org/stable/en/user/styling/sld/cookbook/>
:::

Löydät lyhyen esityksen kuvaustekniikasta ja SLD-koodin. Tutustu lyhyesti koodiin ja yritä löytää tärkeimmät elementit (tagit) kuten monikulmion viivan ja täytön värit sekä tekstien fonttimääritelmät. Voit kirjoittaa muistiinpanoja tärkeimmistä elementeistä ja määritelmistä harjoituksen viimeiselle sivulle.

Esimerkissä **\<Stroke\>**-koodissa on määritelty reunaviivan väri ja paksuus.

**\<TextSymbolizer\>** sisältää tekstitysominaisuudet eli labelit (kartan kohteiden, esimerkiksi katujen nimet) kuten **\<Label\>**, joka määrittää tekstejä varten käytettävän kentän/sarakkeen  ominaisuustiedoista.

Tavanomaisen SLD-kielen lisäksi tämä mallikoodi sisältää kaksi GeoServerin omaa lisäosaa, joita käytetään SLD:ssä tekstien sijoittamiseen. Tunnistat tällaiset kohdat koodista **\<VendorOption\...\>**-tageista.

Etsi SLD-tyylien esimerkkisivuilta **View and download the full "Polygon with styled label" SLD** -linkki, avaa se uudessa ikkunassa ja tallenna kyseinen sivu .sld-tiedostona, käyttämällä selaimen tallennus (save as / tallenna nimellä) toimintoa. Anna tiedostolle nimi, jonka muistat vielä myöhemmin (esimerkiksi polygon_polygonwithstyledlabel.sld).

Palaa nyt GeoServerin käyttöliittymään ja paina koodilaatikon alta **Browse**. Etsi äskettäin ladattu SLD-tyyli levyltä ja paina lopuksi **Upload**.![](https://lh5.googleusercontent.com/aSY-d3KVncXnL2B9QRjPpuVJp8CgCJ9EhIJmen38mYydfx70Gt37oCzJflhXharlT5xCR0D-lSMc2R3U-6O0BlbGVyGOQHISRzLB0fWlNh8KSBRw7s1a-NomoPqy0K8Dp7TTyJMvNQ9PsNfbFkCMElEhf_nk9ROl2K0DP8yR_WdFpW-TJyh-DDaox5fI)

Anna uudelle tyylille nimeksi **rakennukset**. Valitse **helsinki** workspace:ksi.

::: hint-box
Psst! Huomaa, että jos olit aiemmin määritellyt tyylin nimen ja workspacen, GeoServer mahdollisesti korvaa niitä kun lataat .sld tiedostoa.
:::

Voit nyt testata SLD-koodia **Validate-**toiminnolla. Voit esikatsella karttamerkkien selitettä painamalla **Preview legend**.

Muokkaa vielä monikulmion SLD-tyyli seuraavasti:

-   **Täyteväri** (PolygonSymbolizer → FILL) vaaleanpunaiseksi (#FFCC99)

-   **Reunaviivan väri** (PolygonSymbolizer → Stroke) mustaksi (#000000)

-   **Reunaviivan paksuudeksi** 0.5

-   **Aseta** ensimmäisellä rivillä encoding="UTF-8"

::: hint-box
Psst! Huomaa, että GeoServerissä desimaalierottimena toimii ainoastaan piste ".". Tämä pätee kaikissa GeoServerin asetuksissa.
:::

Tallenna sitten muutokset painamalla ensin **Submit**.

Lopuksi vaihda **rakennukset**-tasolle tyyliksi **rakennukset**-tyyli (**Data → Layers → rakennukset → Publishing**).![](https://lh4.googleusercontent.com/-pnzXwZv9wY6_slXUvlVn2NyCzOrmTalEQpR_kOP08mYihQhNvNZcN9wM00BKxDz66vpA3FJayUCi2skI0ACVEKeOumbPakGZoe77L9fDblA8TrgcbJgUuypKT7VnjxsElm25uRCOt2h8Goy05-DA3CqtGDnwdOVizaU1axXxukkYt2qRZBseU8Use0G)

## **SLD-kuvaustekniikan muokkaaminen**

Lisätään vielä teksteille puskuri (halo), niin tekstiä on helpompi lukea.

Palaa **Styles**-näkymälle ja valitse taas **rakennukset**-tyyli. Poista SLD-koodista **\<TextSymbolizer\>**-tagin sisältä:

::: code-box
+---------------------------------------------------------+
| \<Fill\>                                                |
|                                                         |
|    \<CssParameter name="fill"\>#000000\</CssParameter\> |
|                                                         |
| \</Fill\>                                               |
+=========================================================+
+---------------------------------------------------------+
:::

ja korvaa sen tilalle:

::: code-box
+--------------------------------------------------------------+
| \<Halo\>                                                     |
|                                                              |
|    \<Radius\>3\</Radius\>                                    |
|                                                              |
|     \<Fill\>                                                 |
|                                                              |
|         \<CssParameter name="fill"\>#FFFFFF\</CssParameter\> |
|                                                              |
|     \</Fill\>                                                |
|                                                              |
| \</Halo\>                                                    |
+==============================================================+
+--------------------------------------------------------------+
:::

SLD-koodi ikkunassa näyttää tältä:
![](https://lh6.googleusercontent.com/g_4iv_mKEzttrbwJxCWGhVrsj8k6UcNumuGuXIp_1_LU_A8TQAa9Plc9FIuSiAWE2iCHFKZEA6XuIlUnZWeF6Jfx0ObaymaNOAiMmbJQ_latp17MIDVvbhElNXC8VXNjB55hgWcvzFdq3iuQ4cGxph0FfgexjHhAcMnLDQBoYTRvlfdf9VhttBMGGK-F)

Paina sitten **Validate**.

Jos koodin käytössä tulee virheilmoituksia tai se ei toimi, pyydä kouluttajalta apua. Muuten paina **Submit**, niin tyyli tallentuu.

Päivitetty tyyli on heti käytössä palvelimella ja sitä voi esikatsella **rakennukset**-tason avulla. Selainikkunan voit päivittää painamalla **F5**-näppäintätai **CTRL+R**-näppäimiä.

![](https://lh6.googleusercontent.com/CIVWe-X8z4V0Gc6mJUHil9KsDg712M7fV4PWha4WV6ufVsELwXKWUt24HYuyT0KMg3oNcfZvuiQUR7Q5-bF65BfmTQJysFt9Uyh9rRM-8n92jv6_j2gTpTv0Tgfo6IkVB7trOxigdRyaD2Ew_PwPWGIyuPVOttjuz1cWWrcVKkF8npDybNh2BH1mMqvp)

Osoitteessa <http://colorbrewer2.org/> voi tutustua erilaisiin visualisointityyleihin ja valita  sopivia värejä visualisointiin.

## **Tiestön tyylin luominen**

Luo nyt uusi tyyli, jota tullaan käyttämään tiestön kuvaamiseen.

Samalla tavalla kuin aiemmin, käytä hyväksi GeoServerissa olemassa oleva tyyli. **Tiger_roads**-tyyli sopii tiestön kuvaamiseen. Esikatsele tiger_roads-tasoa.![](https://lh6.googleusercontent.com/p-4evIghL3ftHMOO7-EequtfG3XlLRhwl91tT6yxIGnkskz0FDn70W6vd0rlybgI2F2zbdIckQKVvMdvXJAS6u5OvK1BaueqYSWk41Uj_udXSwr0JfDONOgxdXRbXukRAEOypNi57xJ8hTHjRcW-mqe_aVtjkuHGQlVb_9pXuzEvL1HWj7zokJE5rnbC)

Kadut on kuvattu leveinä valkoisina kaistoina kun karttaa lähennetään tarpeeksi. Tehdään seuraavaksi samankaltainen tyyli aikaisemmin julkaistua tiesto-aineistoa varten.

Luo uusi tyyli (**Data → Styles → Add a new style**), nimeä se **tiesto**. Kopioi **simple_roads** tyyli.

Etsi **\<Rule\>** kappaleen sisällä oleva **\<Title\>** ja lisää sen alle:

::: code-box
\<MinScaleDenominator\>32000\</MinScaleDenominator\>
:::

![](https://lh3.googleusercontent.com/ncvreQGdEvYvGZhZWpw79FxdC4gsRHh3xeTzBmQNowkzzcvL1kUFELqxx2EZMmqj71YAkB7c8b4o6DlPY_pAjcEMkHRzFztkRCJPMJMHxWlZOdOzIww081Z7oijAeG6760Q2TV0P9XX42zJlyJsh8iTTnGQ2afM2RG1jymspaR3fTeVt-9iGevQ_T_V4)

Paina sitten **Submit**.

Aseta vielä tiesto-tason oletustyyliksi **tiesto-tyyli**. (**Data → Layers → helsinki:tiesto → Publishing**).![](https://lh6.googleusercontent.com/2BOqTpMR8oapUF8sqTUgCJMxPmhwRMKCdZcI5WLvoUkuY4_nDnoOXpMbddZHQ10Mmp4Lu4ZfK-6VrtViehe3LqWyr9rfr0l0w_4CXRkoVGbTIw7QslwfPuriIlitfh4xEE1VxmMcjpdNCpUgj7jNiBsc5lSeNGVl1GIJYF_iHao947MOTbMokbWFzqZs)

Paina **Save** ja esikatsele tasoa. Huomaa, että kun loitonnat karttaa siten että mittakaava on pienempi kuin 1:32 000, tiet eivät enää tule näkyviin.

Lisätään nyt tiet myös mittakaavaan 1:32 000 ja suuremmille. Tämä onnistuu luomalla **\<Rule\>**-osio, jossa maksimimittakaava (**\<MaxScaleDenominator\>**) on määritelty **32000** arvoksi.

Voit hyödyntää edellisen sääntö osiota: kopioi koko **\<Rule\>** kappale. Lisää se **\</Rule\>** jälkeen.![](https://lh6.googleusercontent.com/T4BVdR1Q-ImpuqWflSoQJBEjWfhV4z5VyL1cuPnGJmirmCJEAw73Et-qhvACT-ob00MJIcgwfrcdCSj8tnZP5kA2GnG-EZ5DHSrwfo5NYHdDXgeDregbVwCqz3yzArJSnw9o0mKHXeL37KIEekND_ji6h5hLaoERySPtMwvv-ykqgdkui5ij8bczmLP9)

Muuta vielä:

::: code-box
\<MinScaleDenominator\>32000\</MinScaleDenominator\>
:::

\... tällaiseksi:

::: code-box
\<MaxScaleDenominator\>32000\</MaxScaleDenominator\>
:::

Vaihda viivan väri harmaaksi **#666666**, otsikoksi **Paksu viiva** ja paksuudeksi **7**.![](https://lh4.googleusercontent.com/F6romb2d9q5LqMrYU5IqdVJw-ZhncAMVSXpGhwIBy3OQz8DVwHpi0SU4XP_5DiMRaljQiVNKBEkQORz9IMjQp37ub-gZRMtBsJB_534fG1yObFPo8VV08r8EDLdwYPs2cs8oFoIgRh1n8CHctMcAAikgWhJwRTNIKxyfaTTZNsRlB5eh4o7kNf8x9XBh)

Paina **Submit** ja esikatsele.Huomaa, että nyt kun lähennät karttaikkunaa (suurennat mittakaavaa), niin teiden väri ja paksuus muuttuu.

Lisätään vielä täyteväri viivoille lisäämällä uusi sääntö. Kopioi edellinen **\<Rule\>** -koodi kappale (jolla on \<MaxScaleDenominator\>32000\</MaxScaleDenominator\>) ja liitä se kopioidun kappaleen jatkoksi.

Muuta taas otsikko, väri ja paksuus kuvan mukaisesti:![](https://lh5.googleusercontent.com/qX-grGsOsPeKkRldMzei_KVhC-59tGFgmYiFQWQgRsoID68wDYvzGHhYKoRUnEG10O9eP4sTUL_r124LN6qCziiVZ6Cg5D9r60efl6n-3rj4O1SZV7v14WKdSB6Po0cSvVVPNJVod9hmxHeCQoN-KYj7BUXExYOnxNwF6SxKFkPaRM-yhy897P87ZMz-)

Tämä viiva tulee piirretyksi edellisen paksumman viivan päälle, josta aiheutuu viivareunan efekti.

Esikatsele lopputulosta:![](https://lh4.googleusercontent.com/DCU26UVSxVUrf2WgbcUztS6eVEYTiAZVpj0UDi_CF80OPoiRxANd0F3zSedlCVBiIY6aXDHZK2lZE-m2o5jZfuG8R_Hc7IcWLvSzIqQ20XD-eaZ2tffYkIVoPJbJARH6oDoUwRWpu_ORcvrhU--fzTVU6gYH3AKs2me5e8BeQ45UIu1BJ2QDhALNdsn4)
