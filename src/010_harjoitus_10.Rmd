# HARJOITUS II.3: ARKKITEHTUURI JA KÄYTTÖÖNOTTO

**Harjoituksen sisältö**

Harjoituksessa tutustutaan tarkemmin GeoServerin lokeihin ja erilaisiin asetuksiin, jotka vaikuttavat suorituskykyyn.

**Harjoituksen tavoite**

Harjoituksen jälkeen opiskelija osaa arvioida GeoServerin suorituskykyä lokien avulla ja tunnistaa erilaisia ongelmatilanteita.

**Arvioitu kesto**

30 minuuttia.

## **Valmistautuminen**

GeoServerin palvelimeen on ladattu erilaisia aineistoja ja GeoServerin **Monitor**-lisäosa on asennettu palvelimeen.

## **Yleistiedot GeoServerin palvelimesta**

Avaa GeoServerin vasemmasta palkista **About & Status → Server Status**.![](https://lh5.googleusercontent.com/INuGmb5JpS_qRR_wK0TBHGhsiUddFA9yTmTj86zFqVK9Tnwjfgoy-0E_-M3-djGwGv82aqGnF36u47zGJQbqqC02ILB_mIcy8pnGWy7YwRLI8sLYUbsTWJbhxW_Tqzm_tojOlmf6Nm3W3aNQeqlcxw)

**Locks**-toiminnon kautta voit tarkistaa olemassa olevat WFS-T -aineistojen lukitukset. Voit tarvittaessa vapauttaa lukitukset painamalla **Free locks**.

**Connections**-tieto viittaa siihen, kuinka monta vektori-storea on saatavilla. 

Voit tarkistaa ja vapauttaa GeoServerin käyttämää muistia **Memory Usage** kohdalla.

## **Image Processing -asetukset**

Tarkista vielä, mitkä Java-asetukset ovat voimassa palvelimessa kuvien käsittelyä varten. Lähtökohtaisesti ei ole kovin tehokasta käsitellä kuvia kokonaisina tietokoneen muistissa. Yleisesti käytetty tapa on jakaa kuvat pienempiin osiin (tiilet/tiles) ja tehdä mahdolliset kuvaoperaattorit pienempiin kuviin. JAI-asetukset (määritelty **Image Processing** -asetuksissa) hallinnoivat näiden menetelmien toimintaa.

JAI (Java Advanced Imaging) asetuksia voit muokata **Settings → Image Processing** -näkymän kautta.![](https://lh4.googleusercontent.com/UmvlxNo3LBn2cbKl4HmaV3M4bmr3NvmO8BQ3s5JHEkYLfMLee7eCX7_gHSElq9UwBVg10YD05KOtDSzEoG7NXdDLAtooQfO8I8A0BzoqalLKBVqCYRE05hWLbeB_urRoTbml_hlIFsh_1j_x-I5tGw)

+----------------------------------------+
| ##### **Image Processing -asetukset**  |
+========================================+
| #### **Memory Capacity ja**            |
|                                        |
| #### **Memory Threshold**              |
+----------------------------------------+
| #### **Tile Recycling**                |
+----------------------------------------+
| #### **Tile Threads ja**               |
|                                        |
| #### **Tile Thread Priority**          |
+----------------------------------------+
| #### **PNG Encoder Type**              |
+----------------------------------------+
| #### **JPEG Native Acceleration**      |
+----------------------------------------+
| #### **Mosaic Native Acceleration ja** |
|                                        |
| #### **Warp Native Acceleration**      |
+----------------------------------------+

Asetusten muutokset näkyvät **Server Status** -sivulla.

## **Raster Access**

Toisin kuin WMS-kuvapyynnöt, WCS-pyynnöt tuottavat mahdollisesti hyvin suuria kuvatiedostoja. Näissä tapauksissa kuvien lataaminen muistista ei ole hyvä ratkaisu, vaan olisi suotavaa käyttää väliaikaista tiedostoa.

**Raster Access** -asetukset määräävät GeoServerin toimintaa kuvapyyntöjen saapuessa. Saat asetukset näkyviin **Settings → Raster Access** -näkymästä:

+----------------------------------------------+
| ##### **Raster Access -asetukset**           |
+==============================================+
| #### **ImageIO cache memory threshold (KB)** |
+----------------------------------------------+
| #### **CPU Use**                             |
+----------------------------------------------+

![](https://lh5.googleusercontent.com/aExGq6pLjVb96e1v1UvZbKaPpzfjDE7DP8H8AT-KrUnXEelLMlK5osC18TScKcdu9ve9p59emyPc400oFVoWna82jjlouUMQOYjR_csBWOcklF1kigvlEDREwtI_t45vXSeAICwu0Dl83gTSb5XSnQ)

**Server Status** -näkymän lopussa on palvelimeen liittyviä asetuksia:

+-------------------------------------+
| ##### **Muut palvelimen asetukset** |
+=====================================+
| #### **Update Sequence**            |
+-------------------------------------+
| #### **Resource cache**             |
+-------------------------------------+
| #### **Configuration and catalog**  |
+-------------------------------------+

## **GeoServerin loki**

Tutustutaan GeoServerin lokin sisältöön ja sen asetuksiin suorittamalla pyyntöjä palvelimeen käyttäen esikatselun toimintoa.

Avaa erilliseen selainikkunaan jonkun tason esikatselu (**Layer Preview**) ja pidä karttaikkuna auki.

Avaa eri selainikkunaan **Settings → Global** näkymää oikeasta palkista.

Avaa kolmanteen selainikkunaan GeoServerin lokien esikatselu (**GeoServer Logs**).![](https://lh6.googleusercontent.com/F_oKajg_wBpuM1deL12niJQKLySlKUwWtUi7UZi_BGvdHTJyvyOs0jXMu6TUlRW3ssKdpawlhYJNa0EsQx0DJuV_pbfz_8em43InVU3Q2fUit7W4uCJk5xhw9kAOtixtVVJ1KJGGl492KuSNoB4wtg)

Tutustu asetuksiin kouluttajan ohjauksella sekä lukemalla lisää tietoa asetuksista Geoserverin manuaalista (**Web Administration Interface → Server → Global Settings**). Avaa manuaali erilliseen selainikkunaan.

Suorita nyt muutamia toimintoja (zoom in, zoom out, pan) karttaikkunassa. 

Tarkista tuliko lokeihin mitään: paina **Refresh**, niin uusimmat rivit lokitiedostosta tuleva näkyville. Voit myös vähentää lokirivien määrää (**Maximum console lines**).

GeoServerin asennuksessa on valmiina ladattuja erilaisia loki-profiileja, jotka raportoivat erilaisia tietoja lokiin.![](https://lh5.googleusercontent.com/n8O89QRr5TYYwVa9A9tpAbx8Z1GQzOhGi3zqqQEFyQeoplVFQH6gMRz-_plhg7gUSsDs8wDSRA9CCYrZ7VubulYvO8a0HkjUZjlye65jTtcTdlto0ldSGEum60Ohb4s1yfPMidv1rlPKBWOXFSNybw)

Voit nyt vaihtaa erilaisia lokitus profiileja ja havainnoida toimintojen aiheuttamat vaikutukset lokitiedostoihin. Kokeile asettaa profiiliksi VERBOSE_LOGGING.properties ja liikuttele karttaa. Päivitä tämän jälkeen loki (refresh) ja katso mitä rivejä lokiin on ilmestynyt.

## **REST API:n toimintaa**

GeoServerin palvelimen asetuksia on mahdollista hallita myös REST-rajapinnan kautta.

Voit tarkistaa REST-rajapinnan kautta saatavilla olevat aineistot kirjoittamalla seuraavan osoitteen web-selaimeen (käytä oman palvelimesi ip-osoitetta):

| http://**oma-ip-osoite**:8080/geoserver/rest/workspaces/ |
|----------------------------------------------------------|

Etsi tiedot edellisissä harjoituksissa luoduista karttatasoista.![](https://lh6.googleusercontent.com/sQy53lRRvI3NAxN8SBiaDb1QC_3JmbpBC7wEcgxXWnVrLmsK6t4BwPLI6zb7vL1tzKVuYwgZg6Vc-_W8bJ1PPzTG-nkuGdLLIA8GG58ybdfuXwkVZiueNwc7K9MBpS8ELyizZuD5jpFhYStY9ZqXRg)

+--------------------------------------------------------------------------------------------------------+
| ##### **Kuinka toteuttaisit uuden kuvaustekniikan tallentamisen GeoServeriin REST-rajapinnan avulla?** |
+========================================================================================================+
+--------------------------------------------------------------------------------------------------------+

+---------------------------------------------------------------------+
| ##### **Psst! Tutustu REST API:n kuvaukseen GeoServerin ohjeessa.** |
+=====================================================================+
+---------------------------------------------------------------------+

## **Monitor-lisäosan käyttö**

GeoServerin **Monitor**-lisäosa on valmiiksi asennettu koulutus palvelimiin ja se näkyy päävalikosta alapuolelta.

Avaa **Monitor → Activity**.

Kokeile esikatsella eri tasoja ja katso sen jälkeen **Monitor → Activity → Daily**-osiosta järjestelmän aktiviteettigrafiikkaa, jonka pitäisi näyttää seuraavanlaiselta:![](https://lh3.googleusercontent.com/LXw6t-Q3tCVBJ3iixQeGSWb84G3EIVJRgS5wv1MKLblvNmEB0ULRDQvlIR8LdL92rBB6ap6uvxYLjn7-41vmickXX20VTk-RKgQ9BzREBTAPmHQm7zbPNKm03v7xNBYLA611QUhmZFOz1UtSDYv-Vg)![](https://lh3.googleusercontent.com/x1mZIWOjI4Y7AoVxey7zNkMsHtLUV8wMsfsrWYAzzm7-5gf9sK_5cngJt0hhfoW5OgmUDkvfdoLugBf6VWzGbeo3SKp4tXUFUU4mpEftfntfv02vona-C8hKZx-aotnSd4esuvYAIqa90PqH8ZGRhQ)
